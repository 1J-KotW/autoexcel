## 1. Исходные данные и цель

Имеется Excel‑файл с несколькими листами, на каждом из которых содержатся списки материалов по различным системам/разделам сметы.  
Общая совокупная длина всех списков превышает 15 000 строк, при этом одни и те же материалы могут повторяться на разных листах и в разных системах.

Цель разработки — автоматизировать заполнение по каждому материалу:

- цены за единицу материала;  
- стоимости работ за единицу материала;

с минимизацией ручного ввода и переиспользованием уже однажды введённых значений для одинаковых материалов.

***

## 2. Задачи (обязательная часть: пункты 1–2)

### 2.1. Автоматическое заполнение цены и стоимости работ

Необходимо реализовать механизм, который:

1. Для каждой строки с материалом на всех листах Excel добавляет/заполняет следующие поля:
   - «Цена материала, за единицу»;  
   - «Стоимость работ, за единицу».

2. Источником данных для этих полей должен быть настроенный справочник (см. ниже), либо уже заполненные значения в тех же файлах (подтягивание по совпадающему материалу).

3. Поддерживается режим:
   - первоначального массового заполнения (на уже существующих файлах);  
   - дальнейшего использования на новых файлах/листах аналогичной структуры.

### 2.2. Оптимизация заполнения через переиспользование данных

Нужно реализовать логику, при которой для одинаковых материалов, встречающихся на разных листах и/или в разных файлах:

- если для материала уже однажды вручную заданы:
  - цена за единицу;  
  - стоимость работ за единицу;  
- то при повторном появлении этого материала значения подтягиваются автоматически, без повторного ручного ввода.

Требования к реализации:

- Должен быть механизм идентификации «одинаковых материалов».  
- В базовом варианте допускается:
  - точное совпадение по названию материала и дополнительному признаку (артикул, код, единица измерения — по согласованию);  
- Должна быть предусмотрена возможность легко донастроить/расширить правила сопоставления материалов (например, добавить нечеткое сравнение строк или отдельные поля).  
- При невозможности однозначно определить материал (нет совпадения/есть несколько кандидатов) система должна:
  - обозначать такие строки как требующие ручной проверки/заполнения;  
  - не затирать уже существующие значения.

***

## 3. Универсальный справочник (для пунктов 1–2, с учётом будущей интеграции п.3)

Для решения задач пунктов 1–2 требуется разработать **универсальный справочник материалов**, который:

- хранит уникальные записи материалов;  
- содержит:
  - каноническое название материала;  
  - единицу измерения;  
  - цену за единицу (актуальную на момент внесения);  
  - стоимость работ за единицу;  
- используется как основной источник значений при заполнении смет.

### 3.1. Базовые требования сейчас (обязательные)

1. Справочник должен быть единым для всех листов и файлов данного заказчика/проекта (а в перспективе — для разных заказчиков).  
2. Должна быть возможность:
   - добавлять новые материалы в справочник (в т.ч. на основе строк из сметы);  
   - корректировать цену и стоимость работ для уже существующих материалов.  
3. Запись в справочнике должна иметь уникальный идентификатор (внутренний ID), который используется для связи с позициями сметы.  
4. Должна быть реализована процедура:
   - «пробежаться» по смете,  
   - попытаться сопоставить каждый материал со справочником,  
   - для найденных совпадений — подставить цену и стоимость работ,  
   - для не найденных — сформировать список/отчёт для ручной обработки.

***

## 4. Учёт изменения цен и вариативности названий (учитывать архитектурно, но без полной реализации сейчас)

Пункт 3 («универсальный справочник для разных заказчиков + автоматическое обновление цен из счетов и/или парсинг с сайтов поставщиков») на текущем этапе считается задачей повышенной сложности и **не реализуется полностью**, но:

- при проектировании структуры данных и логики справочника необходимо:

  1. Заложить возможность:
     - хранить несколько цен для одного материала с привязкой к дате (ценовая история);  
     - в будущем — учитывать разные источники цен (прайсы, счета, сайты).  

  2. Предусмотреть, что названия материалов в исходных таблицах разных заказчиков могут:
     - незначительно отличаться;  
     - содержать дополнительные слова/форматирование.

- Поэтому уже сейчас нужно:
  - спроектировать справочник и логику сопоставления так, чтобы:
    - можно было в будущем добавить:
      - более сложный алгоритм маппинга (fuzzy, ИИ и т.п.);  
      - функционал импорта прайсов и парсинга сайтов;  
    - без полной переделки существующего кода.

Формулировка для разработчика:  
**Реализовать полностью задачи по автоматическому заполнению цен и стоимости работ (пункты 1–2) с использованием универсального справочника, спроектированного так, чтобы к нему можно было в дальнейшем «прицепить» модуль автоматического обновления цен и улучшенный алгоритм сопоставления материалов.**

***

## 5. Требования к результату

На выходе должно быть:

1. Решение (скрипты/надстройка/утилита), которое:  
   - принимая на вход Excel‑файл со множественными листами,  
   - выполняет автоматическое заполнение:
     - цены за единицу материала;  
     - стоимости работ за единицу;  
   - повторно использует уже введённые значения для одинаковых материалов;  
   - сохраняет результат в файл (новый или обновлённый).

2. Универсальный справочник материалов:  
   - с возможностью добавления и редактирования материалов;  
   - с хранением цены за единицу и стоимости работ за единицу;  
   - с архитектурным запасом под:
     - хранение истории цен;  
     - поддержку разных источников цен;  
     - более сложный алгоритм сопоставления материалов.